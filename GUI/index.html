<!DOCTYPE html>
<html>
  
  <head>
    <title></title>
    <link rel="stylesheet" href="./font/HelveticaNeueLight.css">
    <style>
      body {
        background: black;
        margin:0;
        padding:0;
        overflow:hidden;
      }
      .main {
        overflow:hidden;
        transform: rotate(-90deg);
        height: 310px;
        width: 310px;
        color: black;
        position:fixed;
        border-radius: 10000em;
        top:0;
        left:0;
        text-align: center;
        font-family: Helvetica;
        position:absolute;
      }
      canvas {
        display:block;
        position:absolute;
        top:0;
        left:0;
      }
      .main > div{
        display: table-cell;
        width: 310px;
        height: 310px;
        vertical-align: middle;
        color: #fff;
        top:0;
        left:0;
        text-align: center;
      }
      
            
      .loader {
        display: inline-block;
        width: 50px;
        height: 50px;
        position: relative;
        border: 4px solid #fff;
        overflow:hidden;
        animation: loader 2s infinite ease;
      }
      
      .loader-inner {
        vertical-align: top;
        display: inline-block;
        width: 100%;
        background-color: #fff;
        animation: loader-inner 2s infinite ease;
      }
      
      @keyframes loader {
        0% {
          border-color: #2fafff;         
          transform: rotate(0deg);
        }
        
        25% {
          border-color: #fff;         
          transform: rotate(180deg);
        }
        
        50% {
          border-color: #fff;         
          transform: rotate(180deg);
        }
        
        75% {
          border-color: #2fafff;    
          transform: rotate(360deg);
        }
        
        100% {
          border-color: #2fafff;    
          transform: rotate(360deg);
        }
      }
      
      @keyframes loader-inner {
        0% {
          background-color: #2fafff;
          height: 0%;
        }
        
        25% {
          background-color: #fff;          
          height: 0%;
        }
        
        50% {
          background-color: #fff;
          height: 100%;
        }
        
        75% {
          background-color: #2fafff;
          height: 100%;
        }
        
        100% {
          height: 0%;
        }
      }
      
      .i {
        
      }
    </style>
  </head>
  
  <body>
    <div class='main'>
      <div>
        <span class="loader">
          <span class="loader-inner"></span>
        </span>
      </div>
      <div>
        <div>edge-GUI
          <br>
          <b id='log'></b>
          <br>
          <b id='log2'></b>
          </span>
        </div>
      </div>
      <script>
        var os = require('os');
        var fs = require('fs');
        var net = require('net');
         var i = document.getElementById('log');
         var i2 = document.getElementById('log2');
         setInterval(function(){
            i.innerHTML = "mem:" + (100 - (Math.floor((os.freemem() / os.totalmem()) * 1000) / 10)) + "%" ;
         }, 1000);
         
         fs.writeFileSync('/var/GUI', process.pid);
         var rpc = require("../Modules/RPC/index");
         var task = 0;
         
         var tick = false;
         function reconnect(){
             clearTimeout(task);
             task = setTimeout(conntask, 700);
         }
         
         function conntask(){
           try{
             tick = !tick;
             i2.innerHTML = (tick ? "+" : "-") + " Waiting for OS " + (tick ? "-" : "+");
             if(fs.existsSync('/var/GUI_sock')) {
             var _api = JSON.parse(fs.readFileSync('/var/GUI_sock').toString());
             var _rpc;
             var sock = net.connect(_api.port, function (err, result) {
                 if (err) {
                     reconnect();
                 }
                 else {
                     _rpc = new rpc.RPCEndpoint(sock);
                     sock.once('error', reconnect).once('end', reconnect).once('close', reconnect);
                     _api_full = rpc.APIManager.GetAPI(_api, _rpc);
                     global.API = API = _api_full.API;
                     i2.innerHTML = "Edge Connected";
                     API.Hello(function(err, result){
                       i2.innerHTML = result;
                     });
                     
                 }
             }).once('error', reconnect).once('end', reconnect).once('close', reconnect);
           }else{
             reconnect();
           }
           }catch(e){
             reconnect();
           }
         }
         
         conntask();
      </script>
  </body>

</html>